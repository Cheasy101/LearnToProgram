@model Contracts.Requests.SharedStudentStats.StudentProgressResponse

@{
    ViewBag.Title = "–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å—É";
    Layout = "_Layout";
}

<div class="container py-4">
    <h2 class="mb-4">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å—É</h2>

    <div class="row mb-5">
        <div class="col-md-6">
            <canvas id="progressChart" width="400" height="400"></canvas>
        </div>
        <div class="col-md-6 d-flex flex-column justify-content-center">
            <p><strong>–ü—Ä–æ–π–¥–µ–Ω–æ:</strong> @Model.CompletedLessons –∏–∑ @Model.TotalLessons</p>
            <p>
                <strong>–û—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–π—Ç–∏:</strong> @Model.RemainingLessons
            </p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h4>–ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏</h4>
            @if (Model.Completed.Any())
            {
                <div class="list-group">
                    @foreach (var lesson in Model.Completed)
                    {
                        <a asp-controller="Lesson"
                           asp-action="Index"
                           asp-route-id="@lesson.Id"
                           class="list-group-item list-group-item-action d-flex align-items-center gap-3">
                            @if (!string.IsNullOrEmpty(lesson.LessonPhotoUrl))
                            {
                                <img src="/thumbnails/@System.IO.Path.GetFileName(lesson.LessonPhotoUrl)"
                                     style="width: 60px; height: auto;" class="img-thumbnail"/>
                            }
                            else
                            {
                                <div class="text-muted" style="width: 60px;">‚Äì</div>
                            }
                            <span>@lesson.SmallDescription</span>
                        </a>
                    }
                </div>
            }
            else
            {
                <p class="text-muted">–£—Ä–æ–∫–∏ –µ—â—ë –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã</p>
            }
        </div>

        <div class="col-md-6">
            <h4>–£—Ä–æ–∫–∏ –∫ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—é</h4>
            @if (Model.Remaining.Any())
            {
                <div class="list-group">
                    @foreach (var lesson in Model.Remaining)
                    {
                        <a asp-controller="Lesson"
                           asp-action="Index"
                           asp-route-id="@lesson.Id"
                           class="list-group-item list-group-item-action d-flex align-items-center gap-3">
                            @if (!string.IsNullOrEmpty(lesson.LessonPhotoUrl))
                            {
                                <img src="/thumbnails/@System.IO.Path.GetFileName(lesson.LessonPhotoUrl)"
                                     style="width: 60px; height: auto;" class="img-thumbnail"/>
                            }
                            else
                            {
                                <div class="text-muted" style="width: 60px;">‚Äì</div>
                            }
                            <span>@lesson.SmallDescription</span>
                        </a>
                    }
                </div>
            }
            else
            {
                <p class="text-muted">–í—Å–µ —É—Ä–æ–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã üéâ</p>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    const ctx = document.getElementById('progressChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['–ü—Ä–æ–π–¥–µ–Ω–æ', '–û—Å—Ç–∞–ª–æ—Å—å'],
            datasets: [{
                data: [@Model.CompletedLessons, @Model.RemainingLessons],
                backgroundColor: ['#28a745', '#dc3545']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
</script>
}